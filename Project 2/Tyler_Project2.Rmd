---
title: "Team1_Project2"
author: "Tyler, Anushka and David"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
---

```{r init, include=FALSE}
# some of common options (and the defaults) are: 
# include=T, eval=T, echo=T, results='hide'/'asis'/'markup',..., collapse=F, warning=T, message=T, error=T, cache=T, fig.width=6, fig.height=4, fig.dim=c(6,4) #inches, fig.align='left'/'center','right', 
library(ezids)
# knitr::opts_chunk$set(warning = F, results = "markup", message = F)
knitr::opts_chunk$set(warning = F, results = "hide", message = F)
options(scientific=T, digits = 3) 
# options(scipen=9, digits = 3) 
# ‘scipen’: integer. A penalty to be applied when deciding to print numeric values in fixed or exponential notation.  Positive values bias towards fixed and negative towards scientific notation: fixed notation will be preferred unless it is more than ‘scipen’ digits wider.
# use scipen=999 to prevent scientific notation at all times
```

```{r , echo=FALSE}
#Importing `ipums.csv` dataset
getwd()
ipums = data.frame(read.csv('ipums2.csv'))

str(ipums)

#Dropping unnecessary columns: YEAR, EDUCD and EMPSTATD
library(dplyr)
ipums = select(ipums, c(2:6,8))

str(ipums)
xkabledplyhead(ipums, title = 'Ipums dataset')
#Using random sample data (as recommended) with new `ipumsdf`
#set.seed(123)
#ipumsdf = ipums[ sample(nrow(ipums),100000), ]
#ipumsdf
```


```{r, results='markup'}
#Reformatting target column: EMPSTAT

#Checking for unique values
unique(ipums$EMPSTAT)

#According to IPUMS, codes are the following:
# 0 = N/A
# 1 = Employed
# 2 = Unemployed
# 3 = Not in labor force

#Dropping 0 and 3 values
ipums$EMPSTAT <- replace(ipums$EMPSTAT, ipums$EMPSTAT == 0, NA)
ipums$EMPSTAT <- replace(ipums$EMPSTAT, ipums$EMPSTAT == 3, NA)

ipums <- na.omit(ipums)

#Reformatting column to:
# 0 = Unemployed
# 1 = Employed

ipums$EMPSTAT[ipums$EMPSTAT == 2] <- 0

ipums$EMPSTAT <- as.factor(ipums$EMPSTAT)
```

```{r, results='markup'}
#Reformatting columns: EDUC and WORKEDYR

#Checking for unique values
sort(unique(ipums$EDUC))

#According to IPUMS, codes are the following:
# 0 = No schooling
# 1 = 4th grade (Elementary-school)
# 2 = 5th, 6th, 7th or 8th grade (Middle-school)
# 3 = 9th grade
# 4 = 10th grade
# 5 = 11th grade 
# 6 = 12th grade (High-school)
# 7 = 1st year college
# 8 = 2nd year college
# 10 = 4th year college (Undergraduate)
# 11 = 5+ year college (Masters or PHD)

#Reformatting column to:
# 0 = No schooling
# 1 = 4th grade (Elementary-school)
# 2 = 5th, 6th, 7th or 8th grade (Middle-school)
# 3 = 9th, 10th and 11th grade (High-school dropouts)
# 4 = 12th grade (High-school)
# 5 = 1st, 2nd year college (College dropouts)
# 6 = 4th year college (Undergraduate)
# 7 = 5+ year college (Masters or PHD)

ipums$EDUC[ipums$EDUC == 4] <- 3
ipums$EDUC[ipums$EDUC == 5] <- 3
ipums$EDUC[ipums$EDUC == 6] <- 4
ipums$EDUC[ipums$EDUC == 7] <- 5
ipums$EDUC[ipums$EDUC == 8] <- 5
ipums$EDUC[ipums$EDUC == 10] <- 6
ipums$EDUC[ipums$EDUC == 11] <- 7

ipums$EDUC <- as.factor(ipums$EDUC)
```

```{r, results='markup'}
#EDA 

#Proportion table for EDUC
table1 <- table(ipums$EMPSTAT, ipums$EDUC)
table1

#EDUC barplot
barplot( prop.table(table1, 2),
         legend.text = TRUE,
         ylab = "Proportion employment",
         xlab = "Highest education attained",
         names.arg=c('No schooling','Elementary-S','Middle-S','High-D','High-S','College-D','Undergraduate','Masters'),
         args.legend = list(x = "topright",
                          legend = c("Employed", "Unemployed"),
                           inset = c(- 0.06, -0.13),
                          cex = 0.60),
         main = "Barplot of proportion `EMPSTAT` vs `EDUC`", las=2, cex.names=0.75)

```

```{r, results='markup'}
#EDA 

#Age histogram plot by employment 
Unemployed = subset(ipums, ipums$EMPSTAT == 0)

Employed = subset(ipums, ipums$EMPSTAT == 1)

library('ggplot2')
ggplot(Unemployed, aes(AGE, ..count../sum(..count..)*100))+
  geom_histogram(col = 'black', fill ='#FF9999', bins = 20)+
  labs(title = 'Relative frequency histogram of age by Unemployed')+
  xlab('Age')+
  ylab('Frequency %')

ggplot(Employed, aes(AGE, ..count../sum(..count..)*100))+
  geom_histogram(col = 'black', fill ='#009E73', bins = 20)+
  labs(title = 'Relative frequency histogram of age by Employed')+
  xlab('Age')+
  ylab('Frequency %')
```

```{r, results='markup'}
#Reformatting columns: EDUC and WORKEDYR

#Checking for unique values
sort(unique(ipums$EDUC))

#According to IPUMS, codes are the following:
# 1 = Married, spouse present
# 2 = Married, spouse absent
# 3 = Separated	
# 4 = Divorced
# 5 = Widowed
# 6 = Never married/single

#Reformatting to:
# 1 = Married
# 2 = Separated	
# 3 = Divorced
# 4 = Widowed
# 5 = Single

ipums$MARST[ipums$MARST == 2] <- 1
ipums$MARST[ipums$MARST == 3] <- 2
ipums$MARST[ipums$MARST == 4] <- 3
ipums$MARST[ipums$MARST == 5] <- 4
ipums$MARST[ipums$MARST == 6] <- 5

ipums$MARST = as.factor(ipums$MARST)

```


```{r, results='markup'}
#EDA 

#Proportion table for EDUC
table2 <- table(ipums$EMPSTAT, ipums$MARST)
table2

#EDUC barplot
barplot( prop.table(table2, 2),
         legend.text = TRUE,
         ylab = "Proportion employment",
         xlab = "Marital Status",
         names.arg=c('Married','Separated','Divorced','Widowed','Single'),
         args.legend = list(x = "topright",
                          legend = c("Employed", "Unemployed"),
                           inset = c(- 0.06, -0.13),
                          cex = 0.60),
         main = "Barplot of proportion `EMPSTAT` vs `MARST`", las=1, cex.names=0.85)

```


```{r, results='markup'}
#EDA 


#Age histogram plot by employment 
Unemployed = subset(ipums, ipums$EMPSTAT == 0)

Employed = subset(ipums, ipums$EMPSTAT == 1)

library('ggplot2')
ggplot(Unemployed, aes(AGE, ..count../sum(..count..)*100))+
  geom_histogram(col = 'black', fill ='#FF9999', bins = 20)+
  labs(title = 'Relative frequency histogram of age by Unemployed')+
  xlab('Age')+
  ylab('Frequency %')

ggplot(Employed, aes(AGE, ..count../sum(..count..)*100))+
  geom_histogram(col = 'black', fill ='#009E73', bins = 20)+
  labs(title = 'Relative frequency histogram of age by Employed')+
  xlab('Age')+
  ylab('Frequency %')
```

